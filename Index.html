<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>HTCJaSnake</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
// index
<style>
body{
  margin:0;
  background:#111;
  color:white;
  font-family:Arial;
  display:flex;
  flex-direction:column;
  align-items:center;
}

#topbar{
  display:flex;
  gap:10px;
  align-items:center;
  margin:10px;
}

button{
  background:#222;
  color:white;
  border:1px solid #555;
  padding:6px 10px;
  cursor:pointer;
}

#settings{
  display:none;
  opacity:0;
  transition:opacity .5s;
  background:#000a;
  padding:10px;
  border:1px solid #555;
  margin-bottom:10px;
}

canvas{
  background:#000;
  image-rendering:pixelated;
  max-width:90vmin;
  max-height:90vmin;
}

#gameOver{
  display:none;
  position:absolute;
  background:#000d;
  padding:20px;
  border:2px solid white;
  text-align:center;
}

#joystick{
  display:none;
  margin-top:10px;
}
</style>
</head>

<body>

<div id="topbar">
  <div id="score">Score: 0</div>
  <div id="best">Best: 0</div>
  <button id="settingsBtn">⚙️</button>
</div>

<div id="settings">
  <label>Speed</label>
  <input type="range" min="4" max="20" value="10" id="speedSlider"><br>
  <button id="mobileBtn">Mobile Mode: OFF</button>
  <button id="fixBtn">Fix Size: ON</button>
</div>

<canvas id="game" width="400" height="400"></canvas>

<div id="joystick">
  <button onclick="setDir('UP')">⬆</button><br>
  <button onclick="setDir('LEFT')">⬅</button>
  <button onclick="setDir('DOWN')">⬇</button>
  <button onclick="setDir('RIGHT')">➡</button>
</div>

<div id="gameOver">
  <h2>Game Over</h2>
  <div id="finalScore"></div>
  <button onclick="resetGame()">New Game</button>
</div>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
const box=20;
const grid=20;

let snake=[{x:200,y:200}];
let dir=null;
let nextDir=null;
let food=randomFood();
let score=0;
let best=localStorage.getItem("best")||0;
let speed=10;
let gameOver=false;

document.getElementById("best").innerText="Best: "+best;

// SETTINGS
const settings=document.getElementById("settings");
document.getElementById("settingsBtn").onclick=()=>{
  settings.style.display="block";
  setTimeout(()=>settings.style.opacity=1,10);
};

document.getElementById("speedSlider").oninput=e=>{
  speed=+e.target.value;
};

let mobile=false;
document.getElementById("mobileBtn").onclick=()=>{
  mobile=!mobile;
  document.getElementById("joystick").style.display=mobile?"block":"none";
  document.getElementById("mobileBtn").innerText="Mobile Mode: "+(mobile?"ON":"OFF");
};

let fixSize=true;
document.getElementById("fixBtn").onclick=()=>{
  fixSize=!fixSize;
  resize();
  document.getElementById("fixBtn").innerText="Fix Size: "+(fixSize?"ON":"OFF");
};

function resize(){
  if(!fixSize){
    canvas.style.width="400px";
    canvas.style.height="400px";
    return;
  }
  const s=Math.min(innerWidth*0.9,innerHeight*0.7,400);
  canvas.style.width=s+"px";
  canvas.style.height=s+"px";
}
window.onresize=resize;
resize();

// INPUT
document.addEventListener("keydown",e=>{
  if(e.key=="ArrowUp"||e.key=="w") nextDir="UP";
  if(e.key=="ArrowDown"||e.key=="s") nextDir="DOWN";
  if(e.key=="ArrowLeft"||e.key=="a") nextDir="LEFT";
  if(e.key=="ArrowRight"||e.key=="d") nextDir="RIGHT";
});

function setDir(d){ nextDir=d; }

// GAME LOOP
setInterval(loop,1000/60);

let moveTimer=0;

function loop(){
  if(gameOver) return;
  moveTimer+=speed;
  if(moveTimer>=20){
    moveTimer=0;
    move();
  }
  draw();
}

function move(){
  if(nextDir){
    if(snake.length==1 || !isOpposite(dir,nextDir))
      dir=nextDir;
  }
  if(!dir) return;

  const head={...snake[0]};
  if(dir=="UP") head.y-=box;
  if(dir=="DOWN") head.y+=box;
  if(dir=="LEFT") head.x-=box;
  if(dir=="RIGHT") head.x+=box;

  // WALL
  if(head.x<0||head.y<0||head.x>=400||head.y>=400) return end();

  // SELF
  for(let p of snake)
    if(p.x==head.x&&p.y==head.y) return end();

  snake.unshift(head);

  // FOOD
  if(head.x==food.x&&head.y==food.y){
    score++;
    document.getElementById("score").innerText="Score: "+score;
    food=randomFood();
  }else{
    snake.pop();
  }
}

function end(){
  gameOver=true;
  best=Math.max(best,score);
  localStorage.setItem("best",best);
  document.getElementById("best").innerText="Best: "+best;
  document.getElementById("finalScore").innerText="Score: "+score;
  document.getElementById("gameOver").style.display="block";
}

function resetGame(){
  snake=[{x:200,y:200}];
  dir=null;
  nextDir=null;
  score=0;
  gameOver=false;
  food=randomFood();
  document.getElementById("score").innerText="Score: 0";
  document.getElementById("gameOver").style.display="none";
}

// DRAW
function draw(){
  // GRID
  for(let y=0;y<grid;y++)
    for(let x=0;x<grid;x++){
      ctx.fillStyle=(x+y)%2?"#2f7d32":"#3fa34d";
      ctx.fillRect(x*box,y*box,box,box);
    }

  // FOOD
  ctx.fillStyle="red";
  ctx.fillRect(food.x,food.y,box,box);

  // LEAF
  ctx.fillStyle="#6f6";
  ctx.fillRect(food.x+box*0.25,food.y-box*0.75,box*0.5,box*0.75);

  // STICK
  ctx.fillStyle="#964";
  ctx.fillRect(food.x+box*0.45,food.y-box*0.25,box*0.1,box*0.25);

  // SNAKE
  snake.forEach((p,i)=>{
    ctx.fillStyle=i==0?"#4af":"#39f";
    ctx.fillRect(p.x,p.y,box,box);

    if(i==0){
      ctx.fillStyle="black";
      ctx.fillRect(p.x+5,p.y+6,4,4);
      ctx.fillRect(p.x+11,p.y+6,4,4);
    }
  });
}

function randomFood(){
  return{
    x:Math.floor(Math.random()*grid)*box,
    y:Math.floor(Math.random()*grid)*box
  };
}

function isOpposite(a,b){
  return (a=="UP"&&b=="DOWN")||(a=="DOWN"&&b=="UP")||
         (a=="LEFT"&&b=="RIGHT")||(a=="RIGHT"&&b=="LEFT");
}
</script>
</body>
</html>
