<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HTCJaSnake FS</title>

<style>
body{
  margin:0;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  background:#0a0a0a;
  color:#fff;
  font-family:Arial,sans-serif;
}

.light{
  background:#f2f2f2;
  color:#000;
}

#wrap{
  display:flex;
  gap:14px;
}

canvas{
  background:#111;
  border:3px solid #0ff;
  border-radius:14px 14px 0 0; /* top only */
}

.light canvas{
  background:#fff;
}

#controls{
  display:flex;
  flex-direction:column;
  gap:10px;
}

button{
  padding:6px 10px;
  border:none;
  cursor:pointer;
  background:#0ff;
  color:#000;
  border-radius:10px 10px 0 0;
}

input[type=range]{
  width:140px;
}

#score{
  font-size:20px;
  color:#0ff;
}

.light #score{
  color:#007777;
}

/* joystick */
#joystickWrap{
  display:none;
  position:fixed;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
}

#joystickBase{
  width:120px;
  height:120px;
  background:rgba(0,255,255,.15);
  border-radius:50%;
  position:relative;
}

#joystickKnob{
  width:50px;
  height:50px;
  background:#0ff;
  border-radius:50%;
  position:absolute;
  left:35px;
  top:35px;
  touch-action:none;
}
</style>
</head>

<body>

<div id="wrap">
  <canvas id="game" width="400" height="400"></canvas>

  <div id="controls">
    <div id="score">Score: 0</div>

    <label>
      Speed
      <input type="range" id="speedSlider" min="1" max="10" value="3">
    </label>

    <button id="pauseBtn">Pause</button>
    <button id="themeBtn">Light Mode</button>
    <button id="mobileBtn">Mobile Mode</button>
    <button onclick="resetGame()">New Game</button>
  </div>
</div>

<!-- JOYSTICK -->
<div id="joystickWrap">
  <div id="joystickBase">
    <div id="joystickKnob"></div>
  </div>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const box = 20;
let delay = 150;
let snake, food, direction, nextDir;
let score = 0;
let best = 0;
let paused = false;
let mobileMode = false;

const scoreEl = document.getElementById("score");
const slider = document.getElementById("speedSlider");

/* ---------- SPEED (RIGHT = FASTER) ---------- */
function updateSpeed(){
  delay = 220 - slider.value * 18;
}
slider.oninput = updateSpeed;
updateSpeed();

/* ---------- INIT ---------- */
function resetGame(){
  snake = [{x:8*box,y:8*box}];
  direction = null;
  nextDir = null;
  score = 0;
  food = spawnFood();
  scoreEl.innerText = "Score: 0";
}
resetGame();

/* ---------- FOOD ---------- */
function spawnFood(){
  return {
    x:Math.floor(Math.random()*20)*box,
    y:Math.floor(Math.random()*20)*box
  };
}

/* ---------- INPUT (KEYBOARD) ---------- */
document.addEventListener("keydown",e=>{
  const map={
    ArrowUp:"UP",w:"UP",
    ArrowDown:"DOWN",s:"DOWN",
    ArrowLeft:"LEFT",a:"LEFT",
    ArrowRight:"RIGHT",d:"RIGHT"
  };
  const d = map[e.key];
  if(d) setDirection(d);
});

/* ---------- DIRECTION LOGIC ---------- */
function setDirection(dir){
  if(snake.length>1){
    if(
      (dir==="UP"&&direction==="DOWN")||
      (dir==="DOWN"&&direction==="UP")||
      (dir==="LEFT"&&direction==="RIGHT")||
      (dir==="RIGHT"&&direction==="LEFT")
    ) return;
  }
  nextDir = dir;
}

/* ---------- MOVE ---------- */
let lastTime=0;
function loop(t){
  if(t-lastTime>delay && !paused){
    update();
    lastTime=t;
  }
  draw();
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

function update(){
  if(!nextDir) return;
  direction = nextDir;

  let head = {...snake[0]};
  if(direction==="UP") head.y-=box;
  if(direction==="DOWN") head.y+=box;
  if(direction==="LEFT") head.x-=box;
  if(direction==="RIGHT") head.x+=box;

  // wall
  if(head.x<0||head.y<0||head.x>=400||head.y>=400){
    resetGame(); return;
  }

  // self
  for(let s of snake){
    if(s.x===head.x&&s.y===head.y){
      resetGame(); return;
    }
  }

  snake.unshift(head);

  // eat
  if(head.x===food.x&&head.y===food.y){
    score++;
    best=Math.max(best,score);
    scoreEl.innerText=`Score: ${score} | Best: ${best}`;
    food=spawnFood();
  }else{
    snake.pop();
  }
}

/* ---------- DRAW ---------- */
function draw(){
  ctx.clearRect(0,0,400,400);

  // grid
  for(let y=0;y<20;y++){
    for(let x=0;x<20;x++){
      ctx.fillStyle=(x+y)%2?"#064":"#0a3";
      ctx.fillRect(x*box,y*box,box,box);
    }
  }

  // food
  ctx.fillStyle="red";
  ctx.fillRect(food.x,food.y,box,box);

  // snake
  snake.forEach((s,i)=>{
    ctx.fillStyle=i===0?"#0ff":"#0a0";
    ctx.fillRect(s.x,s.y,box,box);
  });
}

/* ---------- UI ---------- */
document.getElementById("pauseBtn").onclick=()=>{
  paused=!paused;
};

document.getElementById("themeBtn").onclick=()=>{
  document.body.classList.toggle("light");
};

document.getElementById("mobileBtn").onclick=()=>{
  mobileMode=!mobileMode;
  document.getElementById("joystickWrap").style.display=
    mobileMode?"block":"none";
};

/* ---------- JOYSTICK ---------- */
const knob=document.getElementById("joystickKnob");
const base=document.getElementById("joystickBase");
let dragging=false;

knob.addEventListener("pointerdown",()=>dragging=true);
document.addEventListener("pointerup",()=>{
  dragging=false;
  knob.style.left="35px";
  knob.style.top="35px";
});

document.addEventListener("pointermove",e=>{
  if(!dragging) return;
  const r=base.getBoundingClientRect();
  let x=e.clientX-r.left-60;
  let y=e.clientY-r.top-60;

  const ang=Math.atan2(y,x);
  if(Math.abs(x)>Math.abs(y)){
    setDirection(x>0?"RIGHT":"LEFT");
  }else{
    setDirection(y>0?"DOWN":"UP");
  }

  knob.style.left=35+x*0.3+"px";
  knob.style.top=35+y*0.3+"px";
});
</script>

</body>
</html>
